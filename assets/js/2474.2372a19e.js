(window.webpackJsonp=window.webpackJsonp||[]).push([[2474],{2665:function(e,t,a){"use strict";a.r(t);var s=a(0),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"class-criticalsection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#class-criticalsection","aria-hidden":"true"}},[e._v("#")]),e._v(" Class CriticalSection")]),e._v(" "),a("p",[e._v("Critical section.")]),e._v(" "),a("h3",{attrs:{id:"aliases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aliases","aria-hidden":"true"}},[e._v("#")]),e._v(" Aliases:")]),e._v(" "),a("ul",[a("li",[e._v("Class "),a("code",[e._v("tf.compat.v1.CriticalSection")])]),e._v(" "),a("li",[e._v("Class "),a("code",[e._v("tf.compat.v2.CriticalSection")]),e._v("\nA "),a("code",[e._v("CriticalSection")]),e._v(" object is a resource in the graph which executes subgraphs in serial order. A common example of a subgraph one may wish to run exclusively is the one given by the following function:")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' v = resource_variable_ops.ResourceVariable(0.0, name="v")\n\ndef count():\n  value = v.read_value()\n  with tf.control_dependencies([value]):\n    with tf.control_dependencies([v.assign_add(1)]):\n      return tf.identity(value)\n')])])]),a("p",[e._v("Here, a snapshot of "),a("code",[e._v("v")]),e._v(" is captured in "),a("code",[e._v("v")]),e._v("alue; and then "),a("code",[e._v("v")]),e._v(" is updated. The snapshot "),a("code",[e._v("v")]),e._v("alue is returned.\nIf multiple workers or threads all execute "),a("code",[e._v("count")]),e._v(" in parallel, there is no guarantee that access to the "),a("code",[e._v("v")]),e._v("ariable "),a("code",[e._v("v")]),e._v(" is atomic at any point within any thread's calculation of "),a("code",[e._v("count")]),e._v(". In fact, e"),a("code",[e._v("v")]),e._v("en implementing an atomic "),a("code",[e._v("count")]),e._v("er that guarantees that the user will see each "),a("code",[e._v("v")]),e._v("alue "),a("code",[e._v("0, 1, ...,")]),e._v(" is currently impossible.\nThe solution is to ensure any access to the underlying resource "),a("code",[e._v("v")]),e._v(" is only processed through a critical section:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" cs = CriticalSection()\nf1 = cs.execute(count)\nf2 = cs.execute(count)\noutput = f1 + f2\nsession.run(output)\n")])])]),a("p",[e._v("The functions "),a("code",[e._v("f1")]),e._v(" and "),a("code",[e._v("f2")]),e._v(" will be executed serially, and updates to "),a("code",[e._v("v")]),e._v(" will be atomic.\nNOTES\nAll resource objects, including the critical section and any captured variables of functions executed on that critical section, will be colocated to the same device (host and cpu/gpu).\nWhen using multiple critical sections on the same resources, there is no guarantee of exclusive access to those resources. This behavior is disallowed by default (but see the kwarg "),a("code",[e._v("exclusive_resource_access")]),e._v(").\nFor example, running the same function in two separate critical sections will not ensure serial execution:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' v = tf.compat.v1.get_variable("v", initializer=0.0, use_resource=True)\ndef accumulate(up):\n  x = v.read_value()\n  with tf.control_dependencies([x]):\n    with tf.control_dependencies([v.assign_add(up)]):\n      return tf.identity(x)\nex1 = CriticalSection().execute(\n  accumulate, 1.0, exclusive_resource_access=False)\nex2 = CriticalSection().execute(\n  accumulate, 1.0, exclusive_resource_access=False)\nbad_sum = ex1 + ex2\nsess.run(v.initializer)\nsess.run(bad_sum)  # May return 0.0\n')])])]),a("h2",{attrs:{id:"init"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#init","aria-hidden":"true"}},[e._v("#")]),e._v(" "),a("strong",[e._v("init")])]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/ops/critical_section_ops.py#L144-L154",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" __init__(\n    name=None,\n    shared_name=None,\n    critical_section_def=None,\n    import_scope=None\n)\n")])])]),a("p",[e._v("Creates a critical section.")]),e._v(" "),a("h2",{attrs:{id:"properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#properties","aria-hidden":"true"}},[e._v("#")]),e._v(" Properties")]),e._v(" "),a("h3",{attrs:{id:"name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#name","aria-hidden":"true"}},[e._v("#")]),e._v(" name")]),e._v(" "),a("h2",{attrs:{id:"methods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#methods","aria-hidden":"true"}},[e._v("#")]),e._v(" Methods")]),e._v(" "),a("h3",{attrs:{id:"execute"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#execute","aria-hidden":"true"}},[e._v("#")]),e._v(" execute")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/ops/critical_section_ops.py#L189-L292",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" execute(\n    fn,\n    exclusive_resource_access=True,\n    name=None\n)\n")])])]),a("p",[e._v("Execute function "),a("code",[e._v("fn")]),e._v("() inside the critical section.\n"),a("code",[e._v("fn")]),e._v(" should not accept any arguments. To add extra arguments to when calling "),a("code",[e._v("fn")]),e._v(" in the critical section, create a lambda:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" critical_section.execute(lambda: fn(*my_args, **my_kwargs))\n")])])]),a("h4",{attrs:{id:"args"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("fn")]),e._v(": The function to execute. Must return at least one tensor.")]),e._v(" "),a("li",[a("code",[e._v("exclusive_resource_access")]),e._v(": Whether the resources required by "),a("code",[e._v("fn")]),e._v(" should be exclusive to this "),a("code",[e._v("CriticalSection")]),e._v(". Default: "),a("code",[e._v("True")]),e._v(". You may want to set this to "),a("code",[e._v("False")]),e._v(" if you will be accessing a resource in read-only mode in two different "),a("code",[e._v("CriticalSection")]),e._v("s.")]),e._v(" "),a("li",[a("code",[e._v("name")]),e._v(": The "),a("code",[e._v("name")]),e._v(" to use when creating the execute operation.")])]),e._v(" "),a("h4",{attrs:{id:"returns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[e._v("The tensors returned from "),a("code",[e._v("fn")]),e._v("().")]),e._v(" "),a("h4",{attrs:{id:"raises"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#raises","aria-hidden":"true"}},[e._v("#")]),e._v(" Raises:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("ValueError")]),e._v(": If "),a("code",[e._v("fn")]),e._v(" attempts to lock this "),a("code",[e._v("CriticalSection")]),e._v(" in any nested or lazy way that may cause a deadlock.")]),e._v(" "),a("li",[a("code",[e._v("ValueError")]),e._v(": If "),a("code",[e._v("exclusive_resource_access == True")]),e._v(" and another "),a("code",[e._v("CriticalSection")]),e._v(" has an execution requesting the same resources as "),a("code",[e._v("fn``. Note, even if")]),e._v("exclusive_resource_access"),a("code",[e._v("is")]),e._v("True"),a("code",[e._v(", if another execution in another``CriticalSection``was created without")]),e._v("exclusive_resource_access=True"),a("code",[e._v(", a``ValueError`` will be ra")]),e._v("is`ed.")])])])}),[],!1,null,null,null);t.default=r.exports}}]);