(window.webpackJsonp=window.webpackJsonp||[]).push([[2516],{2707:function(e,t,a){"use strict";a.r(t);var r=a(0),n=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("Decorator to define a function with a custom gradient.")]),e._v(" "),a("h3",{attrs:{id:"aliases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aliases","aria-hidden":"true"}},[e._v("#")]),e._v(" Aliases:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("tf.compat.v1.custom_gradient")])]),e._v(" "),a("li",[a("code",[e._v("tf.compat.v2.custom_gradient")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" tf.custom_gradient(f)\n")])])]),a("p",[e._v("This decorator allows fine grained control over the gradients of a sequence for operations. This may be useful for multiple reasons, including providing a more efficient or numerically stable gradient for a sequence of operations.\nFor example, consider the following function that commonly occurs in the computation of cross entropy and log likelihoods:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" def log1pexp(x):\n  return tf.math.log(1 + tf.exp(x))\n")])])]),a("p",[e._v("Due to numerical instability, the gradient this function evaluated at x=100 is NaN. For example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" x = tf.constant(100.)\ny = log1pexp(x)\ndy = tf.gradients(y, x) # Will be NaN when evaluated.\n")])])]),a("p",[e._v("The gradient expression can be analytically simplified to provide numerical stability:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" @tf.custom_gradient\ndef log1pexp(x):\n  e = tf.exp(x)\n  def grad(dy):\n    return dy * (1 - 1 / (1 + e))\n  return tf.math.log(1 + e), grad\n")])])]),a("p",[e._v("With this definition, the gradient at x=100 will be correctly evaluated as 1.0.\n"),a("a",{attrs:{href:"https://tensorflow.google.cn/api_docs/python/tf/RegisterGradient",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.RegisterGradient"),a("OutboundLink")],1),e._v("See also  which registers a gradient function for a primitive TensorFlow operation. tf.custom_gradient on the other hand allows for fine grained control over the gradient computation of a sequence of operations.")]),e._v(" "),a("p",[e._v("Note that if the decorated function uses "),a("code",[e._v("Variable")]),e._v("s, the enclosing variable scope must be using "),a("code",[e._v("ResourceVariable")]),e._v("s.")]),e._v(" "),a("h4",{attrs:{id:"args"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),a("h4",{attrs:{id:"returns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://tensorflow.google.cn/api_docs/python/tf/gradients",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.gradients"),a("OutboundLink")],1),e._v("A function h(x) which returns the same value as f(x)[0] and whose gradient (as calculated by ) is determined by f(x)[1].")])])}),[],!1,null,null,null);t.default=n.exports}}]);