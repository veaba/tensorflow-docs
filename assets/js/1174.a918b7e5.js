(window.webpackJsonp=window.webpackJsonp||[]).push([[1174],{1363:function(e,t,a){"use strict";a.r(t);var r=a(0),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"class-onedevicestrategy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#class-onedevicestrategy","aria-hidden":"true"}},[e._v("#")]),e._v(" Class OneDeviceStrategy")]),e._v(" "),a("p",[e._v("A distribution strategy for running on a single device.\n"),a("a",{attrs:{href:"https://www.tensorflow.org/api_docs/python/tf/distribute/Strategy",target:"_blank",rel:"noopener noreferrer"}},[e._v("Strategy"),a("OutboundLink")],1),e._v("Inherits From:")]),e._v(" "),a("h3",{attrs:{id:"aliases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aliases","aria-hidden":"true"}},[e._v("#")]),e._v(" Aliases:")]),e._v(" "),a("ul",[a("li",[e._v("Class "),a("code",[e._v("tf.compat.v2.distribute.OneDeviceStrategy")])])]),e._v(" "),a("h3",{attrs:{id:"used-in-the-tutorials"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#used-in-the-tutorials","aria-hidden":"true"}},[e._v("#")]),e._v(" Used in the tutorials:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("S")]),e._v("a"),a("code",[e._v("v")]),e._v("e"),a("code"),e._v("a"),a("code",[e._v("n")]),e._v("d"),a("code"),e._v("l"),a("code",[e._v("o")]),e._v("a"),a("code",[e._v("d")]),e._v(" "),a("code",[e._v("a")]),e._v(" "),a("code",[e._v("m")]),e._v("o"),a("code",[e._v("d")]),e._v("e"),a("code",[e._v("l")]),e._v(" "),a("code",[e._v("u")]),e._v("s"),a("code",[e._v("i")]),e._v("n"),a("code",[e._v("g")]),e._v(" "),a("code",[e._v("a")]),e._v(" "),a("code",[e._v("d")]),e._v("i"),a("code",[e._v("s")]),e._v("t"),a("code",[e._v("r")]),e._v("i"),a("code",[e._v("b")]),e._v("u"),a("code",[e._v("t")]),e._v("i"),a("code",[e._v("o")]),e._v("n"),a("code"),e._v("s"),a("code",[e._v("t")]),e._v("r"),a("code",[e._v("a")]),e._v("t"),a("code",[e._v("e")]),e._v("g"),a("code",[e._v("y")])]),e._v(" "),a("li",[a("code",[e._v("S")]),e._v("a"),a("code",[e._v("v")]),e._v("e"),a("code"),e._v("a"),a("code",[e._v("n")]),e._v("d"),a("code"),e._v("l"),a("code",[e._v("o")]),e._v("a"),a("code",[e._v("d")]),e._v(" "),a("code",[e._v("m")]),e._v("o"),a("code",[e._v("d")]),e._v("e"),a("code",[e._v("l")]),e._v("s``")])]),e._v(" "),a("p",[e._v("Using this strategy will place any variables created in its scope on the specified device. Input distributed through this strategy will be prefetched to the specified device. Moreover, any functions called via strategy.experimental_run_v2 will also be placed on the specified device as well.")]),e._v(" "),a("p",[e._v("Typical usage of this strategy could be testing your code with the tf.distribute.Strategy API before switching to other strategies which actually distribute to multiple devices/machines.")]),e._v(" "),a("h4",{attrs:{id:"for-example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#for-example","aria-hidden":"true"}},[e._v("#")]),e._v(" For example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(' strategy = tf.distribute.OneDeviceStrategy(device="/gpu:0")\n\nwith strategy.scope():\n  v = tf.Variable(1.0)\n  print(v.device)  # /job:localhost/replica:0/task:0/device:GPU:0\n\ndef step_fn(x):\n  return x * 2\n\nresult = 0\nfor i in range(10):\n  result += strategy.experimental_run_v2(step_fn, args=(i,))\nprint(result)  # 90\n')])])]),a("h2",{attrs:{id:"init"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#init","aria-hidden":"true"}},[e._v("#")]),e._v(" "),a("strong",[e._v("init")])]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/distribute/one_device_strategy.py#L72-L80",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" __init__(device)\n")])])]),a("p",[e._v("Creates a OneDeviceStrategy.")]),e._v(" "),a("h4",{attrs:{id:"args"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("device")]),e._v(": Device string identifier for the "),a("code",[e._v("device")]),e._v(" on which the variables should be placed. See class docs for more details on how the "),a("code",[e._v("device")]),e._v(' is used. Examples: "/cpu:0", "/gpu:0", "/'),a("code",[e._v("device")]),e._v(':CPU:0", "/'),a("code",[e._v("device")]),e._v(':GPU:0"')])]),e._v(" "),a("h2",{attrs:{id:"properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#properties","aria-hidden":"true"}},[e._v("#")]),e._v(" Properties")]),e._v(" "),a("h3",{attrs:{id:"extended"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#extended","aria-hidden":"true"}},[e._v("#")]),e._v(" extended")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.tensorflow.org/api_docs/python/tf/distribute/StrategyExtended",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.distribute.StrategyExtended"),a("OutboundLink")],1),e._v(" with additional methods.")]),e._v(" "),a("h3",{attrs:{id:"num-replicas-in-sync"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#num-replicas-in-sync","aria-hidden":"true"}},[e._v("#")]),e._v(" num_replicas_in_sync")]),e._v(" "),a("p",[e._v("Returns number of replicas over which gradients are aggregated.")]),e._v(" "),a("h2",{attrs:{id:"methods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#methods","aria-hidden":"true"}},[e._v("#")]),e._v(" Methods")]),e._v(" "),a("h3",{attrs:{id:"experimental-distribute-dataset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#experimental-distribute-dataset","aria-hidden":"true"}},[e._v("#")]),e._v(" experimental_distribute_dataset")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/distribute/one_device_strategy.py#L82-L108",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" experimental_distribute_dataset(dataset)\n")])])]),a("p",[e._v("Distributes a tf.data.Dataset instance provided via dataset.")]),e._v(" "),a("p",[e._v("In this case, there is only one device, so this is only a thin wrapper around the input dataset. It will, however, prefetch the input data to the specified device. The returned distributed dataset can be iterated over similar to how regular datasets can.")]),e._v(" "),a("p",[e._v("NOTE: Currently, the user cannot add any more transformations to a distributed dataset.")]),e._v(" "),a("h4",{attrs:{id:"example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example","aria-hidden":"true"}},[e._v("#")]),e._v(" Example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" strategy = tf.distribute.OneDeviceStrategy()\ndataset = tf.data.Dataset.range(10).batch(2)\ndist_dataset = strategy.experimental_distribute_dataset(dataset)\nfor x in dist_dataset:\n  print(x)  # [0, 1], [2, 3],...\n")])])]),a("p",[a("a",{attrs:{href:"https://www.tensorflow.org/api_docs/python/tf/data/Dataset",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.data.Dataset"),a("OutboundLink")],1),e._v("Args: dataset:  to be prefetched to device.")]),e._v(" "),a("h4",{attrs:{id:"returns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[e._v('A "distributed Dataset" that the caller can iterate over.')]),e._v(" "),a("h3",{attrs:{id:"experimental-distribute-datasets-from-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#experimental-distribute-datasets-from-function","aria-hidden":"true"}},[e._v("#")]),e._v(" experimental_distribute_datasets_from_function")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/distribute/one_device_strategy.py#L110-L148",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" experimental_distribute_datasets_from_function(dataset_fn)\n")])])]),a("p",[a("a",{attrs:{href:"https://www.tensorflow.org/api_docs/python/tf/data/Dataset",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.data.Dataset"),a("OutboundLink")],1),e._v("Distributes  instances created by calls to dataset_fn.")]),e._v(" "),a("p",[e._v("dataset_fn will be called once for each worker in the strategy. In this case, we only have one worker and one device so dataset_fn is called once.\n"),a("a",{attrs:{href:"https://www.tensorflow.org/api_docs/python/tf/distribute/InputContext",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.distribute.InputContext"),a("OutboundLink")],1),e._v("The dataset_fn should take an  instance where information about batching and input replication can be accessed:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" def dataset_fn(input_context):\n  batch_size = input_context.get_per_replica_batch_size(global_batch_size)\n  d = tf.data.Dataset.from_tensors([[1.]]).repeat().batch(batch_size)\n  return d.shard(\n      input_context.num_input_pipelines, input_context.input_pipeline_id)\n\ninputs = strategy.experimental_distribute_datasets_from_function(dataset_fn)\n\nfor batch in inputs:\n  replica_results = strategy.experimental_run_v2(replica_fn, args=(batch,))\n")])])]),a("p",[a("a",{attrs:{href:"https://www.tensorflow.org/api_docs/python/tf/data/Dataset",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.data.Dataset"),a("OutboundLink")],1),e._v("IMPORTANT: The  returned by dataset_fn should have a per-replica batch size, unlike experimental_distribute_dataset, which uses the global batch size. This may be computed using input_context.get_per_replica_batch_size.")]),e._v(" "),a("h4",{attrs:{id:"args-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args-2","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("dataset_fn")]),e._v(": A function taking a "),a("code",[e._v("tf.distribute.InputContext")]),e._v(" instance and returning a "),a("code",[e._v("tf.data.Dataset")]),e._v(".")])]),e._v(" "),a("h4",{attrs:{id:"returns-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns-2","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[e._v('A "distributed Dataset", which the caller can iterate over like regular datasets.')]),e._v(" "),a("h3",{attrs:{id:"experimental-local-results"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#experimental-local-results","aria-hidden":"true"}},[e._v("#")]),e._v(" experimental_local_results")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/distribute/one_device_strategy.py#L150-L164",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" experimental_local_results(value)\n")])])]),a("p",[e._v("Returns the list of all local per-replica values contained in value.")]),e._v(" "),a("p",[e._v("In OneDeviceStrategy, the value is always expected to be a single value, so the result is just the value in a tuple.")]),e._v(" "),a("h4",{attrs:{id:"args-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args-3","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("value")]),e._v(": A "),a("code",[e._v("value")]),e._v(" returned by "),a("code",[e._v("experimental_run")]),e._v("(), "),a("code",[e._v("experimental_run")]),e._v("_v2(), "),a("code",[e._v("extended.call_for_each_replica")]),e._v("(), or a variable created in "),a("code",[e._v("scope")]),e._v(".")])]),e._v(" "),a("h4",{attrs:{id:"returns-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns-3","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[e._v("A tuple of values contained in value. If value represents a single value, this returns (value,).")]),e._v(" "),a("h3",{attrs:{id:"experimental-make-numpy-dataset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#experimental-make-numpy-dataset","aria-hidden":"true"}},[e._v("#")]),e._v(" experimental_make_numpy_dataset")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/distribute/distribute_lib.py#L575-L601",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" experimental_make_numpy_dataset(numpy_input)\n")])])]),a("p",[a("a",{attrs:{href:"https://www.tensorflow.org/api_docs/python/tf/data/Dataset",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.data.Dataset"),a("OutboundLink")],1),e._v("Makes a  for input provided via a numpy array.")]),e._v(" "),a("p",[e._v("This avoids adding numpy_input as a large constant in the graph, and copies the data to the machine or machines that will be processing the input.")]),e._v(" "),a("p",[e._v("Note that you will likely need to use experimental_distribute_dataset with the returned dataset to further distribute it with the strategy.")]),e._v(" "),a("h4",{attrs:{id:"example-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-2","aria-hidden":"true"}},[e._v("#")]),e._v(" Example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" numpy_input = np.ones([10], dtype=np.float32)\ndataset = strategy.experimental_make_numpy_dataset(numpy_input)\ndist_dataset = strategy.experimental_distribute_dataset(dataset)\n")])])]),a("h4",{attrs:{id:"args-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args-4","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("numpy_input")]),e._v(": A nest of NumPy input arrays that will be converted into a dataset. Note that lists of Numpy arrays are stacked, as that is normal "),a("code",[e._v("tf.data.Dataset")]),e._v(" behavior.")])]),e._v(" "),a("h4",{attrs:{id:"returns-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns-4","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.tensorflow.org/api_docs/python/tf/data/Dataset",target:"_blank",rel:"noopener noreferrer"}},[e._v("tf.data.Dataset"),a("OutboundLink")],1),e._v("A  representing numpy_input.")]),e._v(" "),a("h3",{attrs:{id:"experimental-run-v2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#experimental-run-v2","aria-hidden":"true"}},[e._v("#")]),e._v(" experimental_run_v2")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/distribute/one_device_strategy.py#L166-L180",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" experimental_run_v2(\n    fn,\n    args=(),\n    kwargs=None\n)\n")])])]),a("p",[e._v("Run fn on each replica, with the given arguments.")]),e._v(" "),a("p",[e._v("In OneDeviceStrategy, fn is simply called within a device scope for the given device, with the provided arguments.")]),e._v(" "),a("h4",{attrs:{id:"args-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args-5","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("fn")]),e._v(": The function to run. The output must be a "),a("code",[e._v("tf.nest")]),e._v(" of "),a("code",[e._v("Tensor")]),e._v("s.")]),e._v(" "),a("li",[a("code",[e._v("args")]),e._v(": (Optional) Positional arguments to "),a("code",[e._v("fn")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("kwargs")]),e._v(": (Optional) Keyword arguments to "),a("code",[e._v("fn")]),e._v(".")])]),e._v(" "),a("h4",{attrs:{id:"returns-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns-5","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[e._v("Return value from running fn.")]),e._v(" "),a("h3",{attrs:{id:"reduce"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reduce","aria-hidden":"true"}},[e._v("#")]),e._v(" reduce")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/distribute/one_device_strategy.py#L182-L213",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" reduce(\n    reduce_op,\n    value,\n    axis\n)\n")])])]),a("p",[e._v("Reduce value across replicas.")]),e._v(" "),a("p",[e._v("In OneDeviceStrategy, there is only one replica, so if axis=None, value is simply returned. If axis is specified as something other than None, such as axis=0, value is reduced along that axis and returned.")]),e._v(" "),a("h4",{attrs:{id:"example-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-3","aria-hidden":"true"}},[e._v("#")]),e._v(" Example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" t = tf.range(10)\n\nresult = strategy.reduce(tf.distribute.ReduceOp.SUM, t, axis=None).numpy()\n# result: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n\nresult = strategy.reduce(tf.distribute.ReduceOp.SUM, t, axis=0).numpy()\n# result: 45\n")])])]),a("h4",{attrs:{id:"args-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#args-6","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("reduce_op")]),e._v(": A "),a("code",[e._v("tf.distribute.ReduceOp")]),e._v(" value specifying how values should be combined.")]),e._v(" "),a("li",[a("code",[e._v("value")]),e._v(': A "per replica" '),a("code",[e._v("value")]),e._v(", e.g. returned by "),a("code",[e._v("experimental_run_v2")]),e._v(" to be combined into a single tensor.")]),e._v(" "),a("li",[a("code",[e._v("axis")]),e._v(": Specifies the dimension to reduce along within each replica's tensor. Should typically be set to the batch dimension, or "),a("code",[e._v("None")]),e._v(" to only reduce across replicas (e.g. if the tensor has no batch dimension).")])]),e._v(" "),a("h4",{attrs:{id:"returns-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns-6","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[e._v("A Tensor.")]),e._v(" "),a("h3",{attrs:{id:"scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scope","aria-hidden":"true"}},[e._v("#")]),e._v(" scope")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/distribute/one_device_strategy.py#L215-L229",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(" scope()\n")])])]),a("p",[e._v("Returns a context manager selecting this Strategy as current.")]),e._v(" "),a("p",[e._v('Inside a with strategy.scope(): code block, this thread will use a variable creator set by strategy, and will enter its "cross-replica context".')]),e._v(" "),a("p",[e._v("In OneDeviceStrategy, all variables created inside strategy.scope() will be on device specified at strategy construction time. See example in the docs for this class.")]),e._v(" "),a("h4",{attrs:{id:"returns-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#returns-7","aria-hidden":"true"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),a("p",[e._v("A context manager to use for creating variables with this strategy.")])])}),[],!1,null,null,null);t.default=s.exports}}]);