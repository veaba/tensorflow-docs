(window.webpackJsonp=window.webpackJsonp||[]).push([[1728],{1919:function(e,_,v){"use strict";v.r(_);var o=v(0),d=Object(o.a)({},(function(){var e=this,_=e.$createElement,v=e._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h2",{attrs:{id:"class-additiveattention"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#class-additiveattention","aria-hidden":"true"}},[e._v("#")]),e._v(" Class AdditiveAttention")]),e._v(" "),v("p",[e._v("Additive attention layer, a.k.a. Bahdanau-style attention.")]),e._v(" "),v("h3",{attrs:{id:"aliases"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#aliases","aria-hidden":"true"}},[e._v("#")]),e._v(" Aliases:")]),e._v(" "),v("ul",[v("li",[e._v("Class "),v("code",[e._v("tf.compat.v1.keras.layers.AdditiveAttention")])]),e._v(" "),v("li",[e._v("Class "),v("code",[e._v("tf.compat.v2.keras.layers.AdditiveAttention")])])]),e._v(" "),v("p",[e._v("Inputs are query tensor of shape [batch_size, Tq, dim], value tensor of shape [batch_size, Tv, dim] and key tensor of shape [batch_size, Tv, dim]. The calculation follows the steps:")]),e._v(" "),v("h4",{attrs:{id:"args"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#args","aria-hidden":"true"}},[e._v("#")]),e._v(" Args:")]),e._v(" "),v("ul",[v("li",[v("code",[e._v("use_scale")]),e._v(": If "),v("code",[e._v("True")]),e._v(", will create a variable to scale the attention scores.")]),e._v(" "),v("li",[v("code",[e._v("causal")]),e._v(": Boolean. Set to "),v("code",[e._v("True")]),e._v(" for decoder self-attent"),v("code",[e._v("i")]),e._v("on. Adds a mask such that pos"),v("code",[e._v("i")]),e._v("t"),v("code",[e._v("i")]),e._v("on "),v("code",[e._v("i")]),e._v(" cannot attend to pos"),v("code",[e._v("i")]),e._v("t"),v("code",[e._v("i")]),e._v("ons "),v("code",[e._v("j > i")]),e._v(". Th"),v("code",[e._v("i")]),e._v("s prevents the flow of "),v("code",[e._v("i")]),e._v("nformat"),v("code",[e._v("i")]),e._v("on from the future towards the past.")])]),e._v(" "),v("h4",{attrs:{id:"call-arguments"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#call-arguments","aria-hidden":"true"}},[e._v("#")]),e._v(" Call Arguments:")]),e._v(" "),v("ul",[v("li",[v("code",[e._v("inputs")]),e._v(":"),v("code"),e._v("L"),v("code",[e._v("i``s``t``")]),e._v("of"),v("code",[e._v("``t``h``e``")]),e._v("follow"),v("code",[e._v("i")]),e._v("ng"),v("code",[e._v("``t``e")]),e._v("n"),v("code",[e._v("s")]),e._v("or"),v("code",[e._v("s")]),e._v(":\n"),v("code",[e._v("q")]),e._v("u"),v("code",[e._v("e")]),e._v("ry:"),v("code"),e._v("Qu"),v("code",[e._v("e")]),e._v("ry"),v("code",[e._v("``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``q``,`` ``d``i``m")]),e._v("].\n"),v("code",[e._v("v``a")]),e._v("lu"),v("code",[e._v("e")]),e._v(":"),v("code"),e._v("V"),v("code",[e._v("a")]),e._v("lu"),v("code",[e._v("e`` ``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``v``,`` ``d``i``m")]),e._v("].\n"),v("code",[e._v("key")]),e._v(":"),v("code"),e._v("Op"),v("code",[e._v("t``i")]),e._v("on"),v("code",[e._v("a")]),e._v("l"),v("code",[e._v("``key`` ``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``v``,`` ``d``i``m")]),e._v("]."),v("code"),e._v("If"),v("code"),e._v("no"),v("code",[e._v("t``")]),e._v("g"),v("code",[e._v("i``v``e")]),e._v("n"),v("code",[e._v(",``")]),e._v("w"),v("code",[e._v("i")]),e._v("ll"),v("code"),e._v("u"),v("code",[e._v("s``e`` ``v``a")]),e._v("lu"),v("code",[e._v("e``")]),e._v("for"),v("code",[e._v("``b")]),e._v("o"),v("code",[e._v("t``h`` ``key`` ``a")]),e._v("n"),v("code",[e._v("d`` ``v``a")]),e._v("lu"),v("code",[e._v("e``,``")]),e._v("w"),v("code",[e._v("h``i``c``h`` ``i``s`` ``t``h``e`` ``m")]),e._v("o"),v("code",[e._v("s``t`` ``c")]),e._v("o"),v("code",[e._v("m``m")]),e._v("on"),v("code",[e._v("``c``a``s``e")]),e._v(".")]),e._v(" "),v("li",[v("code",[e._v("q")]),e._v("u"),v("code",[e._v("e")]),e._v("ry:"),v("code"),e._v("Qu"),v("code",[e._v("e")]),e._v("ry"),v("code",[e._v("``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``q``,`` ``d``i``m")]),e._v("].")]),e._v(" "),v("li",[v("code",[e._v("v``a")]),e._v("lu"),v("code",[e._v("e")]),e._v(":"),v("code"),e._v("V"),v("code",[e._v("a")]),e._v("lu"),v("code",[e._v("e`` ``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``v``,`` ``d``i``m")]),e._v("].")]),e._v(" "),v("li",[v("code",[e._v("key")]),e._v(":"),v("code"),e._v("Op"),v("code",[e._v("t``i")]),e._v("on"),v("code",[e._v("a")]),e._v("l"),v("code",[e._v("``key`` ``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``v``,`` ``d``i``m")]),e._v("]."),v("code"),e._v("If"),v("code"),e._v("no"),v("code",[e._v("t``")]),e._v("g"),v("code",[e._v("i``v``e")]),e._v("n"),v("code",[e._v(",``")]),e._v("w"),v("code",[e._v("i")]),e._v("ll"),v("code"),e._v("u"),v("code",[e._v("s``e`` ``v``a")]),e._v("lu"),v("code",[e._v("e``")]),e._v("for"),v("code",[e._v("``b")]),e._v("o"),v("code",[e._v("t``h`` ``key`` ``a")]),e._v("n"),v("code",[e._v("d`` ``v``a")]),e._v("lu"),v("code",[e._v("e``,``")]),e._v("w"),v("code",[e._v("h``i``c``h`` ``i``s`` ``t``h``e`` ``m")]),e._v("o"),v("code",[e._v("s``t`` ``c")]),e._v("o"),v("code",[e._v("m``m")]),e._v("on"),v("code",[e._v("``c``a``s``e")]),e._v(".")]),e._v(" "),v("li",[v("code",[e._v("m``a``s")]),e._v("k:"),v("code"),e._v("L"),v("code",[e._v("i``s``t``")]),e._v("of"),v("code",[e._v("``t``h``e``")]),e._v("follow"),v("code",[e._v("i")]),e._v("ng"),v("code",[e._v("``t``e")]),e._v("n"),v("code",[e._v("s")]),e._v("or"),v("code",[e._v("s")]),e._v(":\n"),v("code",[e._v("q")]),e._v("u"),v("code",[e._v("e")]),e._v("ry"),v("code",[e._v("_``m``a``s")]),e._v("k:"),v("code"),e._v("A"),v("code",[e._v("``b")]),e._v("ool"),v("code",[e._v("e``a")]),e._v("n"),v("code",[e._v("``m``a``s")]),e._v("k"),v("code",[e._v("``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``q")]),e._v("]."),v("code"),e._v("If"),v("code"),e._v("g"),v("code",[e._v("i``v``e")]),e._v("n"),v("code",[e._v(",`` ``t``h``e``")]),e._v("ou"),v("code",[e._v("t")]),e._v("pu"),v("code",[e._v("t``")]),e._v("w"),v("code",[e._v("i")]),e._v("ll"),v("code",[e._v("``b``e`` ``z``e")]),e._v("ro"),v("code",[e._v("``a``t`` ``t``h``e``")]),e._v("po"),v("code",[e._v("s``i``t``i")]),e._v("on"),v("code",[e._v("s``")]),e._v("w"),v("code",[e._v("h``e")]),e._v("r"),v("code",[e._v("e`` ``m``a``s")]),e._v("k==F"),v("code",[e._v("a")]),e._v("l"),v("code",[e._v("s``e")]),e._v(".\n"),v("code",[e._v("v``a")]),e._v("lu"),v("code",[e._v("e``_``m``a``s")]),e._v("k:"),v("code"),e._v("A"),v("code",[e._v("``b")]),e._v("ool"),v("code",[e._v("e``a")]),e._v("n"),v("code",[e._v("``m``a``s")]),e._v("k"),v("code",[e._v("``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``v")]),e._v("]."),v("code"),e._v("If"),v("code"),e._v("g"),v("code",[e._v("i``v``e")]),e._v("n"),v("code",[e._v(",``")]),e._v("w"),v("code",[e._v("i")]),e._v("ll"),v("code",[e._v("``a")]),e._v("pply"),v("code",[e._v("``t``h``e`` ``m``a``s")]),e._v("k"),v("code",[e._v("``s")]),e._v("u"),v("code",[e._v("c``h`` ``t``h``a``t`` ``v``a")]),e._v("lu"),v("code",[e._v("e``s`` ``a``t``")]),e._v("po"),v("code",[e._v("s``i``t``i")]),e._v("on"),v("code",[e._v("s``")]),e._v("w"),v("code",[e._v("h``e")]),e._v("r"),v("code",[e._v("e`` ``m``a``s")]),e._v("k==F"),v("code",[e._v("a")]),e._v("l"),v("code",[e._v("s``e`` ``d")]),e._v("o"),v("code"),e._v("no"),v("code",[e._v("t`` ``c")]),e._v("on"),v("code",[e._v("t")]),e._v("r"),v("code",[e._v("i``b")]),e._v("u"),v("code",[e._v("t``e`` ``t")]),e._v("o"),v("code",[e._v("``t``h``e``")]),e._v("r"),v("code",[e._v("e``s")]),e._v("ul"),v("code",[e._v("t")]),e._v(".")]),e._v(" "),v("li",[v("code",[e._v("q")]),e._v("u"),v("code",[e._v("e")]),e._v("ry"),v("code",[e._v("_``m``a``s")]),e._v("k:"),v("code"),e._v("A"),v("code",[e._v("``b")]),e._v("ool"),v("code",[e._v("e``a")]),e._v("n"),v("code",[e._v("``m``a``s")]),e._v("k"),v("code",[e._v("``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``q")]),e._v("]."),v("code"),e._v("If"),v("code"),e._v("g"),v("code",[e._v("i``v``e")]),e._v("n"),v("code",[e._v(",`` ``t``h``e``")]),e._v("ou"),v("code",[e._v("t")]),e._v("pu"),v("code",[e._v("t``")]),e._v("w"),v("code",[e._v("i")]),e._v("ll"),v("code",[e._v("``b``e`` ``z``e")]),e._v("ro"),v("code",[e._v("``a``t`` ``t``h``e``")]),e._v("po"),v("code",[e._v("s``i``t``i")]),e._v("on"),v("code",[e._v("s``")]),e._v("w"),v("code",[e._v("h``e")]),e._v("r"),v("code",[e._v("e`` ``m``a``s")]),e._v("k==F"),v("code",[e._v("a")]),e._v("l"),v("code",[e._v("s``e")]),e._v(".")]),e._v(" "),v("li",[v("code",[e._v("v``a")]),e._v("lu"),v("code",[e._v("e``_``m``a``s")]),e._v("k:"),v("code"),e._v("A"),v("code",[e._v("``b")]),e._v("ool"),v("code",[e._v("e``a")]),e._v("n"),v("code",[e._v("``m``a``s")]),e._v("k"),v("code",[e._v("``Tensor``")]),e._v("of"),v("code",[e._v("``s``h``a")]),e._v("p"),v("code",[e._v("e``")]),e._v("["),v("code",[e._v("b``a``t``c``h``_``s``i``z``e``,`` ``T``v")]),e._v("]."),v("code"),e._v("If"),v("code"),e._v("g"),v("code",[e._v("i``v``e")]),e._v("n"),v("code",[e._v(",``")]),e._v("w"),v("code",[e._v("i")]),e._v("ll"),v("code",[e._v("``a")]),e._v("pply"),v("code",[e._v("``t``h``e`` ``m``a``s")]),e._v("k"),v("code",[e._v("``s")]),e._v("u"),v("code",[e._v("c``h`` ``t``h``a``t`` ``v``a")]),e._v("lu"),v("code",[e._v("e``s`` ``a``t``")]),e._v("po"),v("code",[e._v("s``i``t``i")]),e._v("on"),v("code",[e._v("s``")]),e._v("w"),v("code",[e._v("h``e")]),e._v("r"),v("code",[e._v("e`` ``m``a``s")]),e._v("k==F"),v("code",[e._v("a")]),e._v("l"),v("code",[e._v("s``e`` ``d")]),e._v("o"),v("code"),e._v("no"),v("code",[e._v("t`` ``c")]),e._v("on"),v("code",[e._v("t")]),e._v("r"),v("code",[e._v("i``b")]),e._v("u"),v("code",[e._v("t``e`` ``t")]),e._v("o"),v("code",[e._v("``t``h``e``")]),e._v("r"),v("code",[e._v("e``s")]),e._v("ul"),v("code",[e._v("t")]),e._v(".")])]),e._v(" "),v("h4",{attrs:{id:"output-shape"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#output-shape","aria-hidden":"true"}},[e._v("#")]),e._v(" Output shape:")]),e._v(" "),v("p",[e._v("Attention outputs of shape [batch_size, Tq, dim].")]),e._v(" "),v("p",[e._v("The meaning of query, value and key depend on the application. In the case of text similarity, for example, query is the sequence embeddings of the first piece of text and value is the sequence embeddings of the second piece of text. key is usually the same tensor as value.")]),e._v(" "),v("p",[e._v("Here is a code example for using AdditiveAttention in a CNN+Attention network:")]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v(" # Variable-length int sequences.\nquery_input = tf.keras.Input(shape=(None,), dtype='int32')\nvalue_input = tf.keras.Input(shape=(None,), dtype='int32')\n\n# Embedding lookup.\ntoken_embedding = tf.keras.layers.Embedding(max_tokens, dimension)\n# Query embeddings of shape [batch_size, Tq, dimension].\nquery_embeddings = token_embedding(query_input)\n# Value embeddings of shape [batch_size, Tv, dimension].\nvalue_embeddings = token_embedding(query_input)\n\n# CNN layer.\ncnn_layer = tf.keras.layers.Conv1D(\n    filters=100,\n    kernel_size=4,\n    # Use 'same' padding so outputs have the same shape as inputs.\n    padding='same')\n# Query encoding of shape [batch_size, Tq, filters].\nquery_seq_encoding = cnn_layer(query_embeddings)\n# Value encoding of shape [batch_size, Tv, filters].\nvalue_seq_encoding = cnn_layer(value_embeddings)\n\n# Query-value attention of shape [batch_size, Tq, filters].\nquery_value_attention_seq = tf.keras.layers.AdditiveAttention()(\n    [query_seq_encoding, value_seq_encoding])\n\n# Reduce over the sequence axis to produce encodings of shape\n# [batch_size, filters].\nquery_encoding = tf.keras.layers.GlobalAveragePooling1D()(\n    query_seq_encoding)\nquery_value_attention = tf.keras.layers.GlobalAveragePooling1D()(\n    query_value_attention_seq)\n\n# Concatenate query and document encodings to produce a DNN input layer.\ninput_layer = tf.keras.layers.Concatenate()(\n    [query_encoding, query_value_attention])\n\n# Add DNN layers, and create Model.\n# ...\n")])])]),v("h2",{attrs:{id:"init"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#init","aria-hidden":"true"}},[e._v("#")]),e._v(" "),v("strong",[e._v("init")])]),e._v(" "),v("p",[v("a",{attrs:{href:"https://github.com/tensorflow/tensorflow/blob/r2.0/tensorflow/python/keras/layers/dense_attention.py#L401-L403",target:"_blank",rel:"noopener noreferrer"}},[e._v("View source"),v("OutboundLink")],1)]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v(" __init__(\n    use_scale=True,\n    **kwargs\n)\n")])])])])}),[],!1,null,null,null);_.default=d.exports}}]);